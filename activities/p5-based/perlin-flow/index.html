<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Perlin Flow</title>
    <script src="/custom-elements/custom-navbar.js"></script>
    <script src="/custom-elements/custom-badges.js"></script>
    <script src="/custom-elements/custom-guizero.js"></script>
    <script type="module" src="/custom-elements/custom-code-block.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/p5@1.9.1/lib/p5.min.js"></script>
    <script src="/custom-elements/custom-copyright.js"></script>
    <link rel="stylesheet" href="/style.css">
</head>

<body class="container">

    <cc-navbar active="p5" level="3" />

    <h1>Perlin Flow
        <cc-badge-medium/>
    </h1>

    <h2 style="color: red;">UNDER CONSTRUCTION - UNDER CONSTRUCTION - UNDER CONSTRUCTION</h2>

    <section>
        <h2>What will I make?</h2>

        <p>A screensaver-like animation with colourful particles moving smoothly.</p>

        <!-- 
from p5 import *
from random import random, randint, choice
from math import cos, sin

NUM = 500
particles = []

OCTAVES = 6
FALLOFF = 0.4
REZ = 1/500

def setup():
    size(350, 350)
    background(0)
    no_stroke()
    noise_seed(randint(0, 100))
    noise_detail(OCTAVES, FALLOFF)
    for _ in range(NUM):
        particles.append(Particle())

def draw():
    color_mode(RGB)
    background(0, 20)
    color_mode(HSB)
    for p in particles:
        p.update()
        p.display()

class Particle:
    def __init__(self, x=None, y=None, radius=None):
        self.x = x or randint(0, width)
        self.y = y or randint(0, height)
        self.radius = radius or 2
        self.hue = randint(0, 6) * 60

    def update(self):
        t = frame_count / 100
        n = noise(self.x * REZ, self.y * REZ, t)
        n = map(n, 0.25, 0.75, 0, 1)
        n = constrain(n, 0, 1)
        angle = map(n, 0, 1, 0, TWO_PI)
        angle = constrain(angle, 0, 360)
        self.x += 3 * cos(angle)
        self.y += 3 * sin(angle)

        # Method #1 - random (middle)
        if self.x < 0 or self.x > width or self.y < 0 or self.y > height:
            self.x = randint(0, width)
            self.y = randint(0, height)
        
        # # Method #2 - wrap around
        # if self.x < 0:
        #     self.x = width
        #     self.y = randint(0, height)
        # if self.x > width:
        #     self.x = 0
        #     self.y = randint(0, height)
        # if self.y < 0:
        #     self.y = height
        #     self.x = randint(0, width)
        # if self.y > height:
        #     self.y = 0
        #     self.x = randint(0, width)
        
        # # Method #3 - random (edges)
        # if self.x < 0 or self.x > width or self.y < 0 or self.y > height:
        #     if random() < 0.5:
        #         self.x = randint(0, width)
        #         self.y = choice([0, height])
        #     else:
        #         self.x = choice([0, width])
        #         self.y = randint(0, height)

    def display(self):
        d = 2 * self.radius
        fill(self.hue, 255, 255)
        ellipse(self.x, self.y, d, d)

run()
        -->

        <div id="p5-perlin-flow"></div>

        <script>
            new p5(p => {
                const NUM = 500;
                const particles = [];
                const OCTAVES = 6;
                const FALLOFF = 0.4;
                const REZ = 1 / 500;

                p.setup = function() {
                    p.createCanvas(350, 350);
                    p.background(0);
                    p.noStroke();
                    p.noiseSeed(Math.floor(Math.random() * 100));
                    p.noiseDetail(OCTAVES, FALLOFF);
                    for (let i = 0; i < NUM; i++) {
                        particles.push(new Particle());
                    }
                }

                p.draw = function() {
                    p.colorMode(p.RGB);
                    p.background(0, 20);
                    p.colorMode(p.HSB);
                    for (let particle of particles) {
                        particle.update();
                        particle.display();
                    }
                }

                class Particle {
                    constructor(x, y, radius) {
                        this.x = x || Math.floor(Math.random() * p.width);
                        this.y = y || Math.floor(Math.random() * p.height);
                        this.radius = radius || 2;
                        this.hue = Math.floor(Math.random() * 6) * 60;
                    }

                    update() {
                        const t = p.frameCount / 100;
                        let n = p.noise(this.x * REZ, this.y * REZ, t);
                        n = p.map(n, 0.25, 0.75, 0, 1);
                        n = p.constrain(n, 0, 1);
                        let angle = p.map(n, 0, 1, 0, p.TWO_PI);
                        angle = p.constrain(angle, 0, 360);
                        this.x += 3 * p.cos(angle);
                        this.y += 3 * p.sin(angle);

                        // Method #1 - random (middle)
                        if (this.x < 0 || this.x > p.width || this.y < 0 || this.y > p.height) {
                            this.x = Math.floor(Math.random() * p.width);
                            this.y = Math.floor(Math.random() * p.height);
                        }
                    }

                    display() {
                        const d = 2 * this.radius;
                        p.fill(this.hue, 255, 255);
                        p.ellipse(this.x, this.y, d, d);
                    }
                }
            }, "p5-perlin-flow");
        </script>
    </section>

    <section>
        <h2>Instructions</h2>
        <ol>
            <li>Open the <a href="https://editor.raspberrypi.org/en/projects/ajar-plank-most" target="_blank">starter project</a> and click the <strong>Run</strong> button.</li>
            <li>Login to be able to save your work.</li>
            <li>...</li>
        </ol>
    </section>

    <section>
        <h2>What can I try next?</h2>
        <p>...</p>
        <!--
        <p>Here are some things you can try to make the app better. They are independent from each other so you can pick just a couple or do them in a different order. If you get stuck, use the <em>Hints</em> button or read the Guizero documentation (see <a href="../index.html">Build an app with Guizero</a>).</p>
        <p>And of course you can also use your imagination and change the app as you like!</p>
        <ul>
            <li>Add a button to <strong>change the background color</strong>.
                <ol>
                    <li>Create a new <cc-gz-pushbutton/> with <code>text="Background"</code> (or an image) and linked to the <code>on_background</code> callback function.</li>
                    <li>Create a new <code>on_background</code> callback function to change the background color of <code>output_text</code>.</li>
                    <details class="hints">
                        <summary>Hints</summary>
                        <ul>
                            <li>Check the existing <code>on_color</code> callback function. It does almost what you need but it changes the foreground color instead of the background color.</li>
                            <li>Check the documentation for <cc-gz-textbox/> and find the property you need to change.</li>
                        </ul>
                    </details>
                </ol>
            </li>
        </ul>
        -->
    </section>

    <cc-copyright></cc-copyright>
</body>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>

</html>
